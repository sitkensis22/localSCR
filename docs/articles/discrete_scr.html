<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discrete SCR models: discrete state-space and marked individuals • localSCR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Discrete SCR models: discrete state-space and marked individuals">
<meta property="og:description" content="Learn how to simulate and analyze discrete spatial capture-recapture data 
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">localSCR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/classic_scr.html">Classic SCR models: continuous state-space and marked individuals</a>
    </li>
    <li>
      <a href="../articles/discrete_scr.html">Discrete SCR models: discrete state-space and marked individuals</a>
    </li>
    <li>
      <a href="../articles/local_classic_scr.html">Local classic SCR models: continuous state-space and marked individuals</a>
    </li>
    <li>
      <a href="../articles/mark_resight_scr.html">Mark-resight models: continuous state-space with both marked and unmarked individuals</a>
    </li>
    <li>
      <a href="../articles/unmarked_scr.html">Spatial count models: continuous state-space and unmarked individuals</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Discrete SCR models: discrete state-space and
marked individuals</h1>
                        <h4 data-toc-skip class="author">Daniel
Eacker</h4>
            
            <h4 data-toc-skip class="date">2022-05-10</h4>
      
      
      <div class="hidden name"><code>discrete_scr.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>
The forth vignette of the ‘localSCR’ package covers a set of ‘discrete’
Bayesian spatial capture-recapture (SCR) models (Royle et al. 2014).
These inhomogenous point process models are designed to model SCR data
for ‘marked’ or ‘unmarked’ individuals and model the spatial density of
activity centers as a function of some environmental covariate, for
instance. Although many distance detection functions are possible, the
package currently includes only a bivariate normal model of space use,
which is commonly employed in the literature. The package is meant to
ease implementation of Bayesian SCR models using the ‘nimble’ package
(de Valpine et a. 2022), which allows for increased flexibilty with the
ability for the user to include custom functions and assign different
algorithms to specific model parameters. I took advantage of this
functionality with the goal of building a simple, straightforward
workflow that was flexible enough to handle most mainstream SCR analysis
problems. Visit <a href="https://r-nimble.org/download" class="external-link uri">https://r-nimble.org/download</a> for information on
installing ‘nimble’ and Rtools on your computer.
</p>
<p><br></p>
</div>
<div class="section level2">
<h2 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h2>
<p>
</p>
<p>The ‘localSCR’ package implements Bayesian SCR models using the
‘nimble’ package (de Valpine et a. 2022) following methods described in
Royle et al. (2014). We take advantage of recent developments in
computation of SCR models. In this tutorial, two methods are implemented
to decrease computational run time:</p>
<ol style="list-style-type: decimal">
<li>Using vectorized declarations for traps in distance function
calculations</li>
<li>Separating the data augmentation process into two steps (Chandler
2018)</li>
</ol>
<p>In some SCR problems, there are landscape features that create
‘unsuitable’ habitat for the study species. Habitat masks are used to
account for these features and designate suitable (1) or unsuitable (0)
habitat, and can be represented as a matrix or array of binary values.
This restricts the possible locations of latent activity centers to only
suitable habitat, and in our discrete problem we simply exclude the
unsuitable pixels and keep track of the cell indexes. The ‘localSCR’
package provides functions to construct a habitat mask from either
raster or polygon data. In the discrete model, we’ll use the habitat
mask to limit the ‘pixels’ or ‘cells’ of our discrete state-space, such
that only available cells will be sampled.</p>
Finally, in some SCR designs, clusters of trap arrays may be spread out
over the study area such that individuals can only be detected at one of
multiple trap arrays (e.g., Furnas et al. 2018). This necessitates
including the traps as a 3-dimensional array, using a site identifier to
track which site a detected or augmented individual belongs to, and
using a dynamic indexing in the model.

<br><p>
</p>
</div>
<div class="section level2">
<h2 id="functions-used-from-localscr-package">Functions used from ‘localSCR’ package:<a class="anchor" aria-label="anchor" href="#functions-used-from-localscr-package"></a>
</h2>
<ul>
<li>
<code><a href="../reference/get_discrete.html">get_discrete()</a></code> grabs template model for given inputs
using the <code><a href="https://rdrr.io/pkg/nimble/man/nimbleCode.html" class="external-link">nimbleCode()</a></code> function</li>
<li>
<code><a href="../reference/grid_classic.html">grid_classic()</a></code> define state-space grid and extent</li>
<li>
<code><a href="../reference/initialize_classic.html">initialize_classic()</a></code> generate starting locations for
activity area centers</li>
<li>
<code><a href="../reference/mask_polygon.html">mask_polygon()</a></code> create habitat mask matrix or array from
polygon</li>
<li>
<code><a href="../reference/nimSummary.html">nimSummary()</a></code> summarize lists of Markov Chain Monte
Carlo (MCMC) output</li>
<li>
<code><a href="../reference/realized_density.html">realized_density()</a></code> generate realized density surface
from MCMC output</li>
<li>
<code><a href="../reference/run_discrete.html">run_discrete()</a></code> wrapper function to run discrete models
using ‘nimble’ package</li>
<li>
<code><a href="../reference/sim_classic.html">sim_classic()</a></code> simulate basic spatial capture-recapture
data</li>
</ul>
<p><br></p>
</div>
<div class="section level2">
<h2 id="turtorial">Turtorial<a class="anchor" aria-label="anchor" href="#turtorial"></a>
</h2>
<p>This tutorial includes three parts:</p>
<ol style="list-style-type: decimal">
<li>Create ‘classic’ SCR data and convert to discretized format</li>
<li>Workflow for discrete SCR model for marked individuals using a 2D
trap array, sex-specific scaling parameter and habitat mask</li>
<li>Workflow for discrete SCR model for marked individuals using a 3D
trap array, sex-specific scaling parameter and habitat mask</li>
</ol>
<br><p>
</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># load 'localSCR' package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sitkensis22.github.io/localSCR/" class="external-link">localSCR</a></span><span class="op">)</span>
<span class="co">#&gt; Loading required package: nimble</span>
<span class="co">#&gt; nimble version 0.12.2 is loaded.</span>
<span class="co">#&gt; For more information on NIMBLE and a User Manual,</span>
<span class="co">#&gt; please visit https://R-nimble.org.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'nimble'</span>
<span class="co">#&gt; The following object is masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     simulate</span></code></pre></div>
<p><br></p>
<div class="section level3">
<h3 id="create-classic-scr-data-and-convert-to-discretized-format">(1) Create ‘classic’ SCR data and convert to discretized format<a class="anchor" aria-label="anchor" href="#create-classic-scr-data-and-convert-to-discretized-format"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># simulate a single trap array with random positional noise</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">800</span>, <span class="fl">800</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">800</span>, <span class="fl">800</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>
<span class="va">traps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>
<span class="va">traps</span> <span class="op">&lt;-</span> <span class="va">traps</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/prod.html" class="external-link">prod</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimDim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">traps</span><span class="op">)</span><span class="op">)</span>,<span class="op">-</span><span class="fl">20</span>,<span class="fl">20</span><span class="op">)</span> 

<span class="va">mysigma</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span> <span class="co"># simulate sex-specific scaling parameter</span>
<span class="va">mycrs</span> <span class="op">=</span> <span class="fl">32608</span> <span class="co"># EPSG for WGS 84 / UTM zone 8N</span>
<span class="va">pixelWidth</span> <span class="op">=</span> <span class="fl">200</span> <span class="co"># store pixelWidth or grid resolution</span>

<span class="co"># create state-space</span>
<span class="va">Grid</span> <span class="op">=</span> <span class="fu"><a href="../reference/grid_classic.html">grid_classic</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">traps</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, buff <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="va">mysigma</span>, 
                    res <span class="op">=</span> <span class="va">pixelWidth</span><span class="op">)</span>

<span class="co"># create polygon for mask</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="va">poly</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1765</span>,<span class="op">-</span><span class="fl">1765</span>,<span class="fl">1730</span>,<span class="op">-</span><span class="fl">1650</span>,<span class="fl">1600</span>,
              <span class="fl">1650</span>,<span class="fl">0</span>,<span class="fl">1350</span>,<span class="op">-</span><span class="fl">800</span>,<span class="fl">1700</span>,<span class="op">-</span><span class="fl">1850</span>,<span class="fl">1000</span>,<span class="op">-</span><span class="fl">1765</span>,<span class="op">-</span><span class="fl">1765</span><span class="op">)</span>
            ,ncol<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span>  <span class="va">mycrs</span><span class="op">)</span>

<span class="co"># create habitat mask</span>
<span class="va">hab_mask</span> <span class="op">=</span> <span class="fu"><a href="../reference/mask_polygon.html">mask_polygon</a></span><span class="op">(</span>poly <span class="op">=</span> <span class="va">poly</span>, grid <span class="op">=</span> <span class="va">Grid</span><span class="op">$</span><span class="va">grid</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, 
prev_mask <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>

<span class="co"># Simulated abundance</span>
<span class="va">Nsim</span> <span class="op">=</span> <span class="fl">200</span>

<span class="co"># simulate data for uniform state-space and habitat mask</span>
<span class="va">data3d</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_classic.html">sim_classic</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">traps</span>, ext <span class="op">=</span> <span class="va">Grid</span><span class="op">$</span><span class="va">ext</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, 
                     sigma_ <span class="op">=</span> <span class="va">mysigma</span>,  prop_sex <span class="op">=</span> <span class="fl">1</span>, N <span class="op">=</span> <span class="va">Nsim</span>, K <span class="op">=</span> <span class="fl">4</span>, 
                     base_encounter <span class="op">=</span> <span class="fl">0.15</span>,enc_dist <span class="op">=</span> <span class="st">"binomial"</span>,
                     hab_mask <span class="op">=</span> <span class="va">hab_mask</span>, setSeed <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>

<span class="co"># total augmented population size </span>
<span class="va">M</span> <span class="op">=</span> <span class="fl">400</span>

<span class="co"># get initial activity center starting values</span>
<span class="va">s.st</span> <span class="op">=</span> <span class="fu"><a href="../reference/initialize_classic.html">initialize_classic</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">data3d</span><span class="op">$</span><span class="va">y</span>, M<span class="op">=</span><span class="va">M</span>, X<span class="op">=</span><span class="va">traps</span>, ext <span class="op">=</span> <span class="va">Grid</span><span class="op">$</span><span class="va">ext</span>, 
                            hab_mask <span class="op">=</span> <span class="va">hab_mask</span><span class="op">)</span>

<span class="co"># convert traps and starting locations to discrete format</span>
<span class="va">d_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/discretize_classic.html">discretize_classic</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">traps</span>, grid <span class="op">=</span> <span class="va">Grid</span><span class="op">$</span><span class="va">grid</span>, s.st <span class="op">=</span> <span class="va">s.st</span>, 
                            crs_ <span class="op">=</span> <span class="va">mycrs</span>, hab_mask <span class="op">=</span> <span class="va">hab_mask</span><span class="op">)</span>

<span class="co"># inspect discrete data list</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ grid: num [1:270, 1:2] -808 -608 1592 -1208 -1008 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:2] "x" "y"</span>
<span class="co">#&gt;  $ nPix: int 270</span>
<span class="co">#&gt;  $ X   : num [1:25, 1:2] -807.71 -407.71 -7.71 392.29 792.29 ...</span>
<span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span>
<span class="co">#&gt;   .. ..$ : NULL</span>
<span class="co">#&gt;   .. ..$ : chr [1:2] "x" "y"</span>
<span class="co">#&gt;  $ s.st: int [1:400] 174 194 54 178 130 91 156 163 190 193 ...</span>

<span class="co"># make ggplot of grid, and discretized trap locations </span>
<span class="co"># and starting activity center locations</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">grid</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,
                      color<span class="op">=</span><span class="st">"grey60"</span>,size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>,<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span>,size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">grid</span><span class="op">[</span><span class="va">d_list</span><span class="op">$</span><span class="va">s.st</span>,<span class="op">]</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x</span>,y<span class="op">=</span><span class="va">y</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"orangered"</span>,size<span class="op">=</span><span class="fl">0.75</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
          axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p align="center">
<img src="../reference/figures/vignette_04/Fig1.png" style="width:70%"></p>
<p>
</p>
<p><br> Here, we can see the state-space grid that was created after
converting the state-space grid, traps, and initial activity centers
using <code><a href="../reference/discretize_classic.html">discretize_classic()</a></code>. In the figure above, the
state-space <code>grid</code> is reduced after applying a habitat mask
(i.e., the number of rows was decreased) and is plotted with light gray
points. Also, we can see that both the the traps <code>X</code> (shown
as blue points) and initial activity centers <code>s.st</code> (shown as
orange-red points) are discretized and overlap with the grid locations.
We see that the function returns a list of revised grid based on the
habitat mask <code>grid</code>, the number of available pixels
<code>nPix</code>, the discretized trap locations <code>X</code>, and
the grid indices for discretized initial activity center locations
<code>s.st</code> as a vector.</p>
<p>In this example, We arbitrarily chose a grid resolution of 200 in
this example (i.g., <code>res = 200</code>) to save model run time when
creating the initial state-space using <code><a href="../reference/grid_classic.html">grid_classic()</a></code>, but
this will vary by problem. In situations involving habitat masks or
discrete models, it is prudent to test the effect of different grid
resolutions on the estimated abundance and density in SCR models (see
Royle et al. 2014). Also, note the use to the EPSG code to define the
coordinate reference system for our state-space (see <a href="https://epsg.io/32608" class="external-link uri">https://epsg.io/32608</a>).</p>
<p>We also simulated some spatial capture-recapture data using
<code><a href="../reference/sim_classic.html">sim_classic()</a></code>. Above, we simulated a ‘true’ population size
of 200 individuals (<code>N = 200</code>), 4 sampling occasions
(<code>K = 4</code>), a single scaling parameter (<code>sigma_</code>)
of 300 m, a baseline encounter probability of 0.15
(<code>base_encounter = 0.15</code>), the proportion of females (for
example) (<code>prop_sex = 0.6</code>), a binomial encounter
distribution (<code>enc_dist = "binomial"</code>) and we used our
habitat mask (<code>hab_mask = hab_mask</code>). We also use
<code>setSeed = 100</code> to make the simulation reproducible. We
provide the function the extent of the state-space output from
<code><a href="../reference/grid_classic.html">grid_classic()</a></code> as <code>ext = Grid$ext</code>. Note that
Grid is a list.</p>
<p>Next, we’ll use these data components we created above in a discrete
SCR model. The package includes a set of template discrete SCR models
that we will use to run the simple example. Note that since we won’t
directly use <code>hab_mask</code> in the model, we won’t include it as
a data component. Rather, it is accounted for by deleting the
coordinates in the <code>grid</code> that are unsuitable habitat (i.e.,
<code>hab_mask = 0</code>). Also, it would be easy to modify the model
code if covariates were available to model density or the detection
process.</p>

<p><br></p>
</div>
<div class="section level3">
<h3 id="workflow-for-discrete-scr-model-for-marked-individuals-using-a-2d-trap-array-sex-specific-scaling-parameter-and-habitat-mask">(2) Workflow for discrete SCR model for marked individuals using a
2D trap array, sex-specific scaling parameter and habitat mask<a class="anchor" aria-label="anchor" href="#workflow-for-discrete-scr-model-for-marked-individuals-using-a-2d-trap-array-sex-specific-scaling-parameter-and-habitat-mask"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># prepare data</span>
<span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">data3d</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span>,,<span class="op">]</span> <span class="co"># remove augmented records </span>
<span class="co"># covert to 2d by summing over individuals and traps</span>
<span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span> 

<span class="co"># add discretized traps</span>
<span class="va">data</span><span class="op">$</span><span class="va">X</span> <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">X</span><span class="op">/</span><span class="fl">1000</span> <span class="co"># convert to km units</span>

<span class="co"># add grid</span>
<span class="va">data</span><span class="op">$</span><span class="va">grid</span> <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">grid</span><span class="op">/</span><span class="fl">1000</span> <span class="co"># convert to km units</span>

<span class="co"># prepare constants (note that density is now in activity centers/km2 </span>
<span class="co"># and each cell is now 0.01 km2 in area</span>
<span class="va">constants</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>M <span class="op">=</span> <span class="va">M</span>,n0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,J<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimDim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, 
                 K<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimDim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data3d</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,nPix<span class="op">=</span><span class="va">d_list</span><span class="op">$</span><span class="va">nPix</span>,pixArea <span class="op">=</span> <span class="op">(</span><span class="va">pixelWidth</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>,
                 sigma_upper <span class="op">=</span> <span class="fl">1</span>, A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hab_mask</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">pixelWidth</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>

<span class="co"># add z and zeros vector data for latent inclusion indicator</span>
<span class="va">data</span><span class="op">$</span><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">constants</span><span class="op">$</span><span class="va">M</span> <span class="op">-</span> <span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">zeros</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">constants</span><span class="op">$</span><span class="va">M</span> <span class="op">-</span> <span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span>

<span class="co"># define all initial values </span>
<span class="va">inits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.250</span>, <span class="fl">0.350</span><span class="op">)</span>, s <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">s.st</span>,
            alpha0 <span class="op">=</span> <span class="fl">2.8</span>, p0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.05</span>, <span class="fl">0.15</span><span class="op">)</span>,
            z<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">constants</span><span class="op">$</span><span class="va">M</span><span class="op">-</span><span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># parameters to monitor</span>
<span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>,<span class="st">"psi"</span>,<span class="st">"p0"</span>,<span class="st">"N"</span>,<span class="st">"D"</span>,<span class="st">"EN"</span>,<span class="st">"alpha0"</span>,<span class="st">"s"</span>,<span class="st">"z"</span><span class="op">)</span>

<span class="co"># get model</span>
<span class="va">discrete_model</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete.html">get_discrete</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"marked"</span>,dim_y <span class="op">=</span> <span class="fl">2</span>, 
              enc_dist <span class="op">=</span> <span class="st">"binomial"</span>,sex_sigma <span class="op">=</span> <span class="cn">FALSE</span>,
              trapsClustered<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># show model (not run)</span>
<span class="co"># discrete_model</span>

<span class="co"># run model (note this was run on a Mac with 16 GB 2667 MHz DDR4 </span>
<span class="co"># and 2.3 GHz 8-Core Intel Core i9)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/collectivemedia/tictoc" class="external-link">tictoc</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># track time elapsed</span>
<span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="../reference/run_discrete.html">run_discrete</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">discrete_model</span>, data<span class="op">=</span><span class="va">data</span>, constants<span class="op">=</span><span class="va">constants</span>,
        inits<span class="op">=</span><span class="va">inits</span>, params <span class="op">=</span> <span class="va">params</span>,niter <span class="op">=</span> <span class="fl">5000</span>, nburnin<span class="op">=</span><span class="fl">1000</span>, 
        thin<span class="op">=</span><span class="fl">1</span>, nchains<span class="op">=</span><span class="fl">2</span>, parallel<span class="op">=</span><span class="cn">TRUE</span>,  RNGseed <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 1025.869 sec elapsed</span>

<span class="co"># histogram of posterior samples for N (abundance)</span>
<span class="va">samples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">samples</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">==</span><span class="st">"N"</span><span class="op">)</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Abundance"</span>, 
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">400</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">Nsim</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="co"># add line for simulated abundance</span></code></pre></div>
<p align="center">
<img src="../reference/figures/vignette_04/Fig2.png" style="width:70%"></p>
<br><p>
</p>
<p>We note that the discrete model takes much longer to run compared to
the continuous SCR model equivalent (i.e., ‘classic’ model). This
results from using the categorical distribution to sample the pixels of
our discrete state-space. In this example we have a somewhat fine grid
at 200 m, which results 270 cells that the model has to consider for
each individual in our augmented population size of
<code>M = 400</code>. We also can’t take advantage of the block sampling
of activity center coordinates that greatly speeds up the classic model
runs.</p>
<p>We can see from the histogram of the posterior samples of
<code>N</code> that our model estimates were close to the simulated
value of 200 individuals (shown by red line) and were biased just
slightly low at around 196 individuals. This is expected since this is
only one realization of the detection process. In this example, we
divided the pixelWidth by 1,000 in deriving the area (<code>A</code>) in
our list of constants. This allowed us to estimate density in activity
centers/km<sup>2</sup> rather than activity centers/m<sup>2</sup>. Note
that care must be taken with any rescaling of the data or constants.</p>
<p>Next we use<code><a href="../reference/nimSummary.html">nimSummary()</a></code> to quickly summarize the MCMC
samples. Note that there are other options to summarize MCMC output, but
this function is provided with the package and depends partly on the
‘coda’ package. Then, we make a realized density plot of the MCMC
samples using <code><a href="../reference/realized_density.html">realized_density()</a></code>. In this function we make
use of the list of grid and extent we created earlier called
<code>Grid</code> as well as our saved coordinates reference system
(<code>mycrs</code>). I’ll also note that we need to use the argument
<code>discrete = TRUE</code> to indicate that we need to transform the
pixel indices saved for <code>s</code> into the state-space grid
coordinates. The function will automate this for us.</p>
In this example, we also use the ‘raster’ package to make a simple plot
of the realized density output.

<p><br></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summarize MCMC samples (exclude parameters and don't plot)</span>
<span class="fu"><a href="../reference/nimSummary.html">nimSummary</a></span><span class="op">(</span><span class="va">out</span>, exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="st">"z"</span><span class="op">)</span>, trace<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt;        post.mean post.sd    q2.5     q50   q97.5 f0   n.eff  Rhat</span>
<span class="co">#&gt; D         18.222   1.768  15.093  18.148  21.944  1 314.957 1.006</span>
<span class="co">#&gt; EN       196.003  21.492 157.391 194.404 241.130  1 307.866 1.006</span>
<span class="co">#&gt; N        196.798  19.091 163.000 196.000 237.000  1 314.957 1.006</span>
<span class="co">#&gt; alpha0     2.893   0.110   2.679   2.890   3.106  1 316.798 1.006</span>
<span class="co">#&gt; p0         0.167   0.023   0.126   0.167   0.214  1 316.707 1.016</span>
<span class="co">#&gt; psi        0.490   0.054   0.393   0.486   0.603  1 307.866 1.006</span>
<span class="co">#&gt; sigma      0.310   0.021   0.274   0.308   0.358  1 201.439 1.043</span>

<span class="co"># make realized density plot (we don't use the habitat mask here for </span>
<span class="co"># discrete model)</span>
<span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="../reference/realized_density.html">realized_density</a></span><span class="op">(</span>samples <span class="op">=</span> <span class="va">out</span>, grid <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">grid</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, 
                     site <span class="op">=</span> <span class="cn">NULL</span>, hab_mask <span class="op">=</span> <span class="cn">FALSE</span>,discrete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>       
      
<span class="co"># load virdiis color palette and raster libraries      </span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span>

<span class="co"># make simple raster plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">r</span>, col<span class="op">=</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>,
     main<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Realized density (activity centers/0.2 km"</span><span class="op">^</span><span class="fl">2</span><span class="op">*</span><span class="st">")"</span><span class="op">)</span>,
     ylab<span class="op">=</span><span class="st">"Northing"</span>,xlab<span class="op">=</span><span class="st">"Easting"</span><span class="op">)</span></code></pre></div>
<p align="center">
<img src="../reference/figures/vignette_04/Fig3.png" style="width:70%"></p>
<br><p>
</p>
<p>Next we repeat a similar workflow but now we have two trap arrays
that are clustered in space, and thus, there is a negligble chance of
detecting an individual at more than one trap array. In this case, the
functions in ‘localSCR’ can automatically detect that the traps are in a
3-dimensional format and we note that <code>sim_classic</code> will
return a variable called <code>site</code> that identifies which trap
array that each individual (both detected and not detected) belongs to.
Note that the number of rows in the simulated data <code>y</code> will
equal the simulated population size (here in the example,
<code>N = 200</code>). However, because we are using a trick provided by
Chandler (2018) to separate the data augmentation process into two
steps, we only need the encounter data for those individuals that were
detected in the model likelihood. Also, because we have no
occasion-specific detection covariates, we can sum <code>y</code> over
individuals and traps to result in a 2-dimensional encounter history
array (i.e., <code>y[i,j]</code>). This speeds up the model under these
conditions and we can specify this when we get the SCR model template by
setting <code>y_dim = 2</code> in
<code>get_classic(y_dim = 2,...)</code>. Otherwise, the workflow is very
similar to having a 2-dimensional trap array in the previous
example.</p>

<p><br></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># create an array of traps, as an approach where individuals will only be </span>
<span class="co"># detected at one of the trap arrays (e.g., Furnas et al. 2018)</span>
<span class="va">Xarray</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html" class="external-link">array</a></span><span class="op">(</span><span class="cn">NA</span>, dim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">traps</span><span class="op">)</span>,<span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="va">Xarray</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span><span class="op">=</span><span class="va">traps</span>
<span class="va">Xarray</span><span class="op">[</span>,,<span class="fl">2</span><span class="op">]</span><span class="op">=</span><span class="va">traps</span><span class="op">+</span><span class="fl">6000</span> <span class="co"># shift trapping grid to new locations</span>

<span class="co"># create grid and extent for 3D trap array</span>
<span class="va">GridX</span> <span class="op">=</span> <span class="fu"><a href="../reference/grid_classic.html">grid_classic</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Xarray</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, buff <span class="op">=</span> <span class="fl">3</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">mysigma</span><span class="op">)</span>, 
                     res <span class="op">=</span> <span class="va">pixelWidth</span><span class="op">)</span>

<span class="co"># create polygon to use as a mask</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span>
<span class="va">poly</span> <span class="op">=</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_polygon</a></span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1660</span>,<span class="op">-</span><span class="fl">1750</span>,<span class="fl">8730</span>,<span class="op">-</span><span class="fl">1050</span>,<span class="fl">7470</span>,
<span class="fl">7550</span>,<span class="fl">0</span>,<span class="fl">7950</span>,<span class="op">-</span><span class="fl">1800</span>,<span class="fl">8200</span>,<span class="op">-</span><span class="fl">1660</span>,<span class="op">-</span><span class="fl">1750</span><span class="op">)</span>,ncol<span class="op">=</span><span class="fl">2</span>, byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, crs <span class="op">=</span>  <span class="va">mycrs</span><span class="op">)</span>

<span class="co"># make ggplot</span>
<span class="va">g1</span><span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">GridX</span><span class="op">$</span><span class="va">grid</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">V1</span>,y<span class="op">=</span><span class="va">V2</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"grey60"</span>,size<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Xarray</span><span class="op">[</span>,,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">V1</span>,y<span class="op">=</span><span class="va">V2</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span>,size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">GridX</span><span class="op">$</span><span class="va">grid</span><span class="op">[</span>,,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">V1</span>,y<span class="op">=</span><span class="va">V2</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"grey60"</span>,size<span class="op">=</span><span class="fl">1.25</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Xarray</span><span class="op">[</span>,,<span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">V1</span>,y<span class="op">=</span><span class="va">V2</span><span class="op">)</span>,color<span class="op">=</span><span class="st">"blue"</span>,size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">poly</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>datum<span class="op">=</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">mycrs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting"</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2000</span>,<span class="fl">9000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2000</span>,<span class="fl">9000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,
               axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p align="center">
<img src="../reference/figures/vignette_04/Fig4.png" style="width:70%"></p>
<br><p>
In the figure we can see our two spatially separated trapping grids and
that the polgon overlaps some of the gridded area. The area outside the
polygon will be considered unsuitable when the habitat matrix is
created. Note that the <code>site</code> variable will be only as long
as the simulated population size (here, 300) and thus, we will need to
augment the variable to have the length equal to the total augmented
population size (i.e., <code>M = 600</code>). Otherwise the workflow is
very similar to the previous one where we’ll use
<code><a href="../reference/discretize_classic.html">discretize_classic()</a></code> to convert our ‘classic’ SCR data to a
discrete format. We’ll use some of the items we created above in this
example (e.g., <code>mysigma</code>,<code>mycrs</code>).
</p>
<p><br></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># get 3D habitat mask array for 3D grid</span>
<span class="va">hab_mask</span> <span class="op">=</span> <span class="fu"><a href="../reference/mask_polygon.html">mask_polygon</a></span><span class="op">(</span>poly <span class="op">=</span> <span class="va">poly</span>, grid <span class="op">=</span> <span class="va">GridX</span><span class="op">$</span><span class="va">grid</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, 
prev_mask <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>

<span class="co"># simuated population size</span>
<span class="va">Nsim</span> <span class="op">=</span> <span class="fl">300</span>

<span class="co"># augmented population size</span>
<span class="va">M</span><span class="op">=</span><span class="fl">600</span>

<span class="co"># simulate data for uniform state-space and habitat mask </span>
<span class="co"># (N is simulated abundance)</span>
<span class="va">data4d</span> <span class="op">=</span> <span class="fu"><a href="../reference/sim_classic.html">sim_classic</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">Xarray</span>, ext <span class="op">=</span> <span class="va">GridX</span><span class="op">$</span><span class="va">ext</span>, crs_ <span class="op">=</span> <span class="va">mycrs</span>, 
                 sigma_ <span class="op">=</span> <span class="va">mysigma</span>, prop_sex <span class="op">=</span> <span class="fl">1</span>,N <span class="op">=</span> <span class="va">Nsim</span>, 
                 K <span class="op">=</span> <span class="fl">4</span>, base_encounter <span class="op">=</span> <span class="fl">0.15</span>, 
                 enc_dist <span class="op">=</span> <span class="st">"binomial"</span>,hab_mask <span class="op">=</span> <span class="va">hab_mask</span>, 
                 setSeed <span class="op">=</span> <span class="fl">300</span><span class="op">)</span>

<span class="co"># augment site identifier</span>
<span class="va">site</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="va">data4d</span><span class="op">$</span><span class="va">site</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="op">(</span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data4d</span><span class="op">$</span><span class="va">site</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
                       <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="op">(</span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">length</a></span><span class="op">(</span><span class="va">data4d</span><span class="op">$</span><span class="va">site</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># get initial activity center starting values </span>
<span class="va">s.st</span> <span class="op">=</span> <span class="fu"><a href="../reference/initialize_classic.html">initialize_classic</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">data4d</span><span class="op">$</span><span class="va">y</span>, M<span class="op">=</span><span class="va">M</span>, X<span class="op">=</span><span class="va">Xarray</span>, ext <span class="op">=</span> <span class="va">GridX</span><span class="op">$</span><span class="va">ext</span>, 
                            site <span class="op">=</span> <span class="va">site</span>, hab_mask <span class="op">=</span> <span class="va">hab_mask</span><span class="op">)</span>

<span class="co"># convert traps and starting locations to discrete format</span>
<span class="va">d_list</span> <span class="op">=</span> <span class="fu"><a href="../reference/discretize_classic.html">discretize_classic</a></span><span class="op">(</span>X<span class="op">=</span><span class="va">Xarray</span>, grid <span class="op">=</span> <span class="va">GridX</span><span class="op">$</span><span class="va">grid</span>, s.st <span class="op">=</span> <span class="va">s.st</span>, 
                            crs_ <span class="op">=</span> <span class="va">mycrs</span>,site<span class="op">=</span><span class="va">site</span>, hab_mask <span class="op">=</span> <span class="va">hab_mask</span><span class="op">)</span>

<span class="co"># inspect discrete data list</span>
<span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">)</span>
<span class="co">#&gt; List of 4</span>
<span class="co">#&gt;  $ grid: num [1:284, 1:2, 1:2] -1608 -1408 -1208 -1008 -808 ...</span>
<span class="co">#&gt;  $ nPix: int [1:2] 284 278</span>
<span class="co">#&gt;  $ X   : num [1:25, 1:2, 1:2] -807.71 -407.71 -7.71 392.29 792.29 ...</span>
<span class="co">#&gt;  $ s.st: num [1:600] 98 115 115 165 77 94 77 96 75 109 ...</span>

<span class="co"># prepare data</span>
<span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">data4d</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span>,,<span class="op">]</span> <span class="co"># remove augmented records </span>
<span class="co"># covert to 2d by summing over individuals and traps</span>
<span class="va">data</span><span class="op">$</span><span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="va">sum</span><span class="op">)</span> 

<span class="co"># add discretized traps</span>
<span class="va">data</span><span class="op">$</span><span class="va">X</span> <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">X</span> <span class="co">#/1000 # convert to km units</span>

<span class="co"># add grid</span>
<span class="va">data</span><span class="op">$</span><span class="va">grid</span> <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">grid</span> <span class="co">#/1000 # convert to km units</span>

<span class="co"># prepare constants (note that density is now in activity centers/km2 </span>
<span class="co"># and each cell is now 0.02 km2 in area</span>
<span class="va">constants</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>M <span class="op">=</span> <span class="va">M</span>,n0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/ncell.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>,J<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>,site<span class="op">=</span><span class="va">site</span>,
                 K<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">data4d</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>,nPix<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">nPix</span><span class="op">)</span>,
                 pixArea <span class="op">=</span> <span class="op">(</span><span class="va">pixelWidth</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>,
                 sigma_upper <span class="op">=</span> <span class="fl">1000</span>, 
                 A <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">hab_mask</span><span class="op">)</span><span class="op">*</span><span class="op">(</span><span class="op">(</span><span class="va">pixelWidth</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span>,
                 nSites <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span>

<span class="va">constants</span><span class="op">$</span><span class="va">npixSite</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimMatrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">d_list</span><span class="op">$</span><span class="va">nPix</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,
                              <span class="va">d_list</span><span class="op">$</span><span class="va">nPix</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="fl">1</span>,
                              <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">nPix</span><span class="op">)</span><span class="op">)</span>,
                            ncol<span class="op">=</span><span class="fl">2</span>,byrow<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># add z and zeros vector data for latent inclusion indicator</span>
<span class="va">data</span><span class="op">$</span><span class="va">z</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">constants</span><span class="op">$</span><span class="va">M</span> <span class="op">-</span> <span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span>
<span class="va">data</span><span class="op">$</span><span class="va">zeros</span> <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">constants</span><span class="op">$</span><span class="va">M</span> <span class="op">-</span> <span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span>

<span class="co"># define all initial values </span>
<span class="va">inits</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">250</span>, <span class="fl">350</span><span class="op">)</span>, s <span class="op">=</span> <span class="va">d_list</span><span class="op">$</span><span class="va">s.st</span>,
            alpha0 <span class="op">=</span> <span class="op">-</span><span class="fl">11.25</span>, p0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/dimensions.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">d_list</span><span class="op">$</span><span class="va">X</span><span class="op">)</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="fl">0.05</span>, <span class="fl">0.15</span><span class="op">)</span>,
            z<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>,<span class="va">constants</span><span class="op">$</span><span class="va">M</span><span class="op">-</span><span class="va">constants</span><span class="op">$</span><span class="va">n0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># parameters to monitor</span>
<span class="va">params</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sigma"</span>,<span class="st">"psi"</span>,<span class="st">"p0"</span>,<span class="st">"N"</span>,<span class="st">"D"</span>,<span class="st">"EN"</span>,<span class="st">"alpha0"</span>,<span class="st">"s"</span>,<span class="st">"z"</span><span class="op">)</span>

<span class="co"># get model</span>
<span class="va">discrete_model</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_discrete.html">get_discrete</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"marked"</span>,dim_y <span class="op">=</span> <span class="fl">2</span>, 
              enc_dist <span class="op">=</span> <span class="st">"binomial"</span>,sex_sigma <span class="op">=</span> <span class="cn">FALSE</span>,
              trapsClustered<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># show model (not run)</span>
<span class="co"># discrete_model</span>

<span class="co"># run model (note this was run on a Mac with 16 GB 2667 MHz DDR4 </span>
<span class="co"># and 2.3 GHz 8-Core Intel Core i9)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/collectivemedia/tictoc" class="external-link">tictoc</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">tic</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># track time elapsed</span>
<span class="va">out</span> <span class="op">=</span> <span class="fu"><a href="../reference/run_discrete.html">run_discrete</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">discrete_model</span>, data<span class="op">=</span><span class="va">data</span>, constants<span class="op">=</span><span class="va">constants</span>,
        inits<span class="op">=</span><span class="va">inits</span>, params <span class="op">=</span> <span class="va">params</span>,niter <span class="op">=</span> <span class="fl">5000</span>, nburnin<span class="op">=</span><span class="fl">1000</span>, 
        thin<span class="op">=</span><span class="fl">1</span>, nchains<span class="op">=</span><span class="fl">2</span>, parallel<span class="op">=</span><span class="cn">TRUE</span>,  RNGseed <span class="op">=</span> <span class="fl">500</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/tictoc/man/tic.html" class="external-link">toc</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; 1612.656 sec elapsed</span>

<span class="co"># histogram of posterior samples for N (abundance)</span>
<span class="va">samples</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">out</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/raster/man/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">samples</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">out</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">==</span><span class="st">"EN"</span><span class="op">)</span><span class="op">]</span>, xlab <span class="op">=</span> <span class="st">"Expected abundance"</span>, 
     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">600</span><span class="op">)</span>, main<span class="op">=</span><span class="st">""</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v<span class="op">=</span><span class="va">Nsim</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span> <span class="co"># add line for simulated abundance</span></code></pre></div>
<p align="center">
<img src="../reference/figures/vignette_04/Fig5.png" style="width:70%"></p>
<p><br></p>
<br><p>
</p>
<p>We might run a few more iterations to have everything nicely
converged, but we won’t do that here given that it took about 20 minutes
to run the model. We’ll use<code><a href="../reference/nimSummary.html">nimSummary()</a></code> to quickly
summarize the MCMC samples and check convergence.</p>
We again make a realized density surface and note that the
<code><a href="../reference/realized_density.html">realized_density()</a></code> function outputs a list of length 2 in
this example since we have 2 spatially separated trapping grids here
that are in a 3-dimensional array format. I’ll again note that we need
to use the argument <code>discrete = TRUE</code> to indicate that we
need to transform the pixel indices saved for <code>s</code> into the
state-space grid coordinates. The function will automate this for us.
We’ll need to provide the extent <code>ext = GridX$ext</code> since we
have a 3-dimensional trapping array.

<p><br></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># summary table of MCMC output (exclude "s" and "z" parameters)</span>
<span class="fu"><a href="../reference/nimSummary.html">nimSummary</a></span><span class="op">(</span><span class="va">out</span>, exclude <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"s"</span>,<span class="st">"z"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;        post.mean post.sd    q2.5     q50   q97.5 f0   n.eff  Rhat</span>
<span class="co">#&gt; D         13.131   1.397  10.676  12.989  16.192  1 175.165 1.011</span>
<span class="co">#&gt; EN       294.564  33.831 232.157 291.304 367.164  1 178.972 1.011</span>
<span class="co">#&gt; N        295.180  31.395 240.000 292.000 364.000  1 175.165 1.011</span>
<span class="co">#&gt; alpha0   -11.249   0.114 -11.481 -11.254 -11.022  0 188.347 1.013</span>
<span class="co">#&gt; p0[1]      0.148   0.025   0.104   0.147   0.199  1 294.255 1.033</span>
<span class="co">#&gt; p0[2]      0.128   0.023   0.088   0.127   0.179  1 324.642 1.032</span>
<span class="co">#&gt; psi        0.491   0.056   0.387   0.486   0.612  1 178.972 1.011</span>
<span class="co">#&gt; sigma    287.695  23.052 250.820 284.677 339.804  1 139.887 1.103</span>

<span class="co"># generate realized density surface</span>
<span class="va">r</span> <span class="op">=</span> <span class="fu"><a href="../reference/realized_density.html">realized_density</a></span><span class="op">(</span>samples<span class="op">=</span><span class="va">out</span>, grid<span class="op">=</span><span class="va">d_list</span><span class="op">$</span><span class="va">grid</span>, ext <span class="op">=</span> <span class="va">GridX</span><span class="op">$</span><span class="va">ext</span>,
            crs_<span class="op">=</span><span class="va">mycrs</span>,site<span class="op">=</span><span class="va">constants</span><span class="op">$</span><span class="va">site</span>, discrete<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># load needed packages for multiplot</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oscarperpinan.github.io/rastervis/" class="external-link">rasterVis</a></span><span class="op">)</span>

<span class="co"># plot raster from site 1</span>
<span class="va">p1</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">r</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>na.value <span class="op">=</span> <span class="cn">NA</span>, name<span class="op">=</span><span class="st">"Density"</span>,
          limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span>,breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span>,by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot raster from site 2</span>
<span class="va">p2</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/pkg/rasterVis/man/gplot-methods.html" class="external-link">gplot</a></span><span class="op">(</span><span class="va">r</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>na.value <span class="op">=</span> <span class="cn">NA</span>, name<span class="op">=</span><span class="st">"Density"</span>,
          limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span><span class="op">)</span>,breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span>,by<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
          <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">18</span><span class="op">)</span><span class="op">)</span>

<span class="co"># arrange the two plots in a single row</span>
<span class="va">prow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>,
           <span class="va">p2</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span>,
           align <span class="op">=</span> <span class="st">'vh'</span>,
           labels <span class="op">=</span> <span class="cn">NULL</span>,
           hjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,
           nrow <span class="op">=</span> <span class="fl">1</span>
           <span class="op">)</span>

<span class="co"># extract the legend from one of the plots</span>
<span class="va">legend_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/get_legend.html" class="external-link">get_legend</a></span><span class="op">(</span><span class="va">p1</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"top"</span>,
                        legend.direction <span class="op">=</span> <span class="st">"horizontal"</span>,
                        legend.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span><span class="op">)</span>,
                        legend.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># add the legend above the row we made earlier. Give it 20% of the height</span>
<span class="co"># of one plot (via rel_heights).</span>
<span class="va">pcomb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span><span class="va">legend_t</span>, <span class="va">prow</span>, ncol <span class="op">=</span> <span class="fl">1</span>, rel_heights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimble-R-functions.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>

<span class="co"># add x and y axis labels</span>
<span class="va">pcomb</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/annotate_figure.html" class="external-link">annotate_figure</a></span><span class="op">(</span><span class="va">pcomb</span>, bottom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="st">"Easting"</span>, 
              gp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">18</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,
              left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html" class="external-link">textGrob</a></span><span class="op">(</span><span class="st">"Northing"</span>, rot<span class="op">=</span><span class="fl">90</span>, gp<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/gpar.html" class="external-link">gpar</a></span><span class="op">(</span>fontsize<span class="op">=</span><span class="fl">18</span><span class="op">)</span>,
              vjust <span class="op">=</span> <span class="fl">1</span>, hjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">pcomb</span></code></pre></div>
<p align="center">
<img src="../reference/figures/vignette_04/Fig6.png" style="width:90%"></p>
<br><p>
</p>
<p>That’s it for the discrete models! You’ve made it through the fourth
‘localSCR’ tutorial. Please see Royle et al. (2014) for more details
about SCR theory and modeling. The next tutorials will focus on applying
local approaches to ‘classic’ and discrete SCR models. We’ll see that
significant reductions in computational run time can occur with local
approaches depending on the problem, but especially for discrete SCR
models where we deal with relatively slow run time when there are many
pixels to sample from.</p>

<p><br></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Chandler, R. B. 2018. Speeding up data augmentation in BUGS. <a href="https://groups.google.com/forum/#!topic/hmecology/o6cWDqHHgOE" class="external-link uri">https://groups.google.com/forum/#!topic/hmecology/o6cWDqHHgOE</a>.</p>
<p>de Valpine P, C. Paciorek, D. Turek, N. Michaud, C. Anderson-Bergman,
F. Obermeyer, C. C. Wehrhahn, A. Rodrìguez, L. D. Temple, and S.
Paganin. 2022. <em>NIMBLE: MCMC, Particle Filtering, and Programmable
Hierarchical Modeling</em>. doi: 10.5281/zenodo.1211190 (URL: <a href="https://doi.org/10.5281/zenodo.1211190" class="external-link uri">https://doi.org/10.5281/zenodo.1211190</a>), R package
version 0.12.2, URL: <a href="https://cran.r-project.org/package=nimble" class="external-link uri">https://cran.r-project.org/package=nimble</a>.</p>
<p>Furnas, B. J., R. H. Landers, S. Hill, S. S. Itoga, and B. N. Sacks.
2018. Integrated modeling to estimate population size and composition of
mule deer. Journal of Wildlife Management 82:1429–1441.</p>
<p>Royle, J. A., R. B. Chandler, R. Sollmann, and B. Gardner. 2014.
Spatial capture‐recapture. Academic Press, Waltham, Massachusetts,
USA.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Daniel Eacker.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
